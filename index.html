<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Retro Game Portal</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{
      --bg:#020617;
      --panel:#0b1220cc;
      --muted:#1e293b;
      --accent:#38bdf8;
      --text:#e5e7eb;
    }

    html,body{height:100%}
    body{
      margin:0;
      padding:20px;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,Arial,sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      overflow-x:hidden;
    }

    #particles{
      position:fixed;
      inset:0;
      z-index:-1;
      pointer-events:none;
      overflow:hidden;
    }

    .particle{
      position:absolute;
      width:6px;
      height:6px;
      background:var(--accent);
      border-radius:50%;
      opacity:0.35;
      animation:floatUp linear infinite;
      will-change:transform,opacity;
    }

    @keyframes floatUp{
      from{transform:translateY(110vh) translateX(0);}
      to{transform:translateY(-10vh) translateX(0);}
    }

    header h1{
      margin:0 0 18px 0;
      font-size:26px;
      color:var(--accent);
      text-shadow:0 0 3px rgba(14,165,233,0.6);
    }

    .box{
      background:var(--panel);
      padding:14px;
      border-radius:10px;
      border:1px solid var(--muted);
      margin-bottom:16px;
    }

    .game-entry{
      display:flex;
      align-items:center;
      gap:12px;
      margin:8px 0;
      padding:10px;
      background:rgba(15,23,42,0.8);
      border-radius:8px;
      border:1px solid var(--muted);
    }

    .game-entry a{
      color:var(--accent);
      font-size:15px;
      text-decoration:none;
    }

    .game-entry a:hover{
      text-decoration:underline;
    }

    .tag{
      font-size:11px;
      padding:4px 8px;
      border-radius:999px;
      background:var(--muted);
      color:var(--text);
      margin-left:auto;
    }

    #credits-btn{
      padding:10px 18px;
      background:var(--muted);
      color:var(--text);
      border:none;
      border-radius:8px;
      cursor:pointer;
      font-size:15px;
    }

    #credits-panel{display:none;margin-top:12px;padding:12px;background:rgba(15,23,42,0.8);border-radius:8px;border:1px solid var(--muted);}

    /* small screens */
    @media (max-width:520px){
      .game-entry{flex-direction:column;align-items:flex-start}
      .tag{margin-left:0}
    }
  </style>
</head>
<body>

  <div id="particles" aria-hidden="true"></div>

  <header>
    <h1>Retro Game Portal</h1>
  </header>

  <main>
    <section class="box" aria-labelledby="flash-heading">
      <h2 id="flash-heading" style="margin:0 0 10px 0;color:#7dd3fc;font-size:18px">Flash Games</h2>
      <div id="game-list" role="list"></div>
    </section>

    <section class="box" style="text-align:center;">
      <button id="credits-btn" aria-expanded="false">Credits</button>
      <div id="credits-panel" aria-hidden="true">
        <h3 style="margin-top:0;color:#7dd3fc">Credits</h3>
        <p style="margin:6px 0">• Portal Developer: <strong>Dominic</strong></p>
        <p style="margin:6px 0">• Assistant & Code Support: <strong>Microsoft Copilot</strong></p>
        <p style="margin:6px 0">• Flash Emulator: <strong>Ruffle</strong></p>
        <p style="margin:6px 0">• Game Authors: <strong>Flipline Studios, Nitrome, Armor Games, and original creators</strong></p>
      </div>
    </section>
  </main>

  <script>
    /* ======= CONFIG ======= */
    // Flash-only visible list. HTML5 entries are kept commented/hidden for quick re-enable.
    const games = [
      { title: "The Pit", file: "415482_The_Pit.swf", type: "flash" },
      { title: "Bank NG", file: "457209_Bank_NG.swf", type: "flash" },
      { title: "Prison NG", file: "533001_PrisonNG.swf", type: "flash" },
      { title: "Diamond NGSP", file: "574241_DiamondNGSP.swf", type: "flash" },

      { title: "Cactus McCoy", file: "cactusmccoy.swf", type: "flash" },
      { title: "Cactus McCoy 2", file: "cactusmccoy2.swf", type: "flash" },

      { title: "Jacksmith", file: "jacksmith.swf", type: "flash" },

      { title: "Papa Louie", file: "papalouie_v2.swf", type: "flash" },
      { title: "Papa Louie 2", file: "PapaLouie2.swf", type: "flash" },
      { title: "Papa Louie 3", file: "PapaLouie3.swf", type: "flash" },

      { title: "Papa's Bakeria", file: "papasbakeria.swf", type: "flash" },
      { title: "Papa's Burgeria", file: "papasburgeria.swf", type: "flash" },
      { title: "Papa's Cheeseria", file: "papascheeseria_102.swf", type: "flash" },
      { title: "Papa's Cupcakeria", file: "papascupcakeria.swf", type: "flash" },
      { title: "Papa's Donuteria", file: "papasdonuteria.swf", type: "flash" },
      { title: "Papa's Freezeria", file: "papasfreezeria.swf", type: "flash" },
      { title: "Papa's Hot Doggeria", file: "papashotdoggeria.swf", type: "flash" },
      { title: "Papa's Pancakeria", file: "papaspancakeria.swf", type: "flash" },
      { title: "Papa's Pastaria", file: "papaspastaria.swf", type: "flash" },
      { title: "Papa's Pizzeria", file: "papaspizzeria_v2.swf", type: "flash" },
      { title: "Papa's Scooperia", file: "papasscooperia_v102.swf", type: "flash" },
      { title: "Papa's Sushiria", file: "papassushiria.swf", type: "flash" },
      { title: "Papa's Taco Mia", file: "papastacomia.swf", type: "flash" },
      { title: "Papa's Wingeria", file: "papaswingeria.swf", type: "flash" },

      { title: "Rock Garden", file: "rockgarden_v2.swf", type: "flash" },
      { title: "Midnight March", file: "snjmidnightmarch.swf", type: "flash" },
      { title: "Steak and Jake", file: "steakandjake_freeversion.swf", type: "flash" },

      // HTML5 entries kept here but commented out for quick re-enable:
      // { title: "Slope", folder: "slope", type: "html5" },
      // { title: "DOOM (WebAssembly)", folder: "doom", type: "html5" },
      // { title: "DOOM 3 (WebGL)", folder: "doom3", type: "html5" },
    ];

    /* ======= PERFORMANCE TWEAKS ======= */
    // particle count reduced for smoother performance
    const PARTICLE_COUNT = 12;

    // cache TTL (ms) for file existence checks
    const CACHE_TTL = 1000 * 60 * 60 * 6; // 6 hours

    /* ======= UTIL ======= */
    function cacheKey(path){ return `exists_cache::${path}`; }

    async function fileExistsFetch(path){
      // try cache
      try {
        const raw = localStorage.getItem(cacheKey(path));
        if (raw){
          const parsed = JSON.parse(raw);
          if (Date.now() - parsed.t < CACHE_TTL){
            return parsed.exists;
          }
        }
      } catch(e){ /* ignore storage errors */ }

      // HEAD request
      try {
        const res = await fetch(path, { method: "HEAD" });
        const ok = res.ok;
        try {
          localStorage.setItem(cacheKey(path), JSON.stringify({ t: Date.now(), exists: ok }));
        } catch(e){}
        return ok;
      } catch (e){
        return false;
      }
    }

    /* ======= BUILD LIST (parallel checks + batched DOM update) ======= */
    async function buildGameList(){
      const list = document.getElementById('game-list');

      // prepare checks in parallel
      const checks = games.map(game => {
        if (game.type === 'flash'){
          return fileExistsFetch(`flash-games/${game.file}`);
        } else {
          // hidden HTML5 support retained
          return fileExistsFetch(`html5-games/${game.folder}/index.html`);
        }
      });

      const results = await Promise.all(checks);

      // build fragment
      const frag = document.createDocumentFragment();

      for (let i = 0; i < games.length; i++){
        const game = games[i];
        const exists = results[i];

        // show only flash entries visually
        if (game.type !== 'flash') continue;
        if (!exists) continue;

        const entry = document.createElement('div');
        entry.className = 'game-entry';
        entry.setAttribute('role','listitem');

        const a = document.createElement('a');
        const urlTitle = encodeURIComponent(game.title.replace(/ /g, '+'));
        a.href = `flash-game.html?file=${encodeURIComponent(game.file)}&title=${urlTitle}`;
        a.textContent = game.title;
        a.setAttribute('aria-label', game.title + ' (opens in new page)');

        const tag = document.createElement('span');
        tag.className = 'tag';
        tag.textContent = 'Flash';

        entry.appendChild(a);
        entry.appendChild(tag);
        frag.appendChild(entry);
      }

      list.appendChild(frag);
    }

    /* ======= PARTICLES (lightweight) ======= */
    (function spawnParticles(){
      const container = document.getElementById('particles');
      for (let i=0;i<PARTICLE_COUNT;i++){
        const p = document.createElement('div');
        p.className = 'particle';
        // random horizontal offset and slight horizontal drift via transform
        const left = Math.random() * 100;
        p.style.left = left + 'vw';
        p.style.top = (80 + Math.random() * 30) + 'vh';
        p.style.animationDuration = (8 + Math.random() * 8) + 's';
        p.style.animationDelay = (Math.random() * 4) + 's';
        p.style.opacity = (0.15 + Math.random() * 0.45).toString();
        // small horizontal drift using CSS transform translateX via animation timing
        p.style.transform = `translateX(${(Math.random()-0.5)*10}vw)`;
        container.appendChild(p);
      }
    })();

    /* ======= CREDITS TOGGLE ======= */
    document.getElementById('credits-btn').addEventListener('click', () => {
      const panel = document.getElementById('credits-panel');
      const expanded = panel.style.display !== 'none' && panel.style.display !== '';
      panel.style.display = expanded ? 'none' : 'block';
      document.getElementById('credits-btn').setAttribute('aria-expanded', String(!expanded));
      panel.setAttribute('aria-hidden', String(expanded));
    });

    /* ======= INIT ======= */
    // minimal delay to allow paint before heavy work
    requestAnimationFrame(() => {
      buildGameList().catch(()=>{/* ignore build errors */});
    });
  </script>
</body>
</html>
